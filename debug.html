
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Debug Suite</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; background: #2a2a2a; }
        .pass { color: #00ff00; }
        .fail { color: #ff0000; }
        .warning { color: #ffff00; }
        .info { color: #00aaff; }
        button { padding: 10px; margin: 5px; background: #333; color: white; border: none; cursor: pointer; }
        textarea { width: 100%; height: 200px; background: #1a1a1a; color: #00ff00; border: 1px solid #333; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ðŸ”§ RPG Debug Suite</h1>
    
    <div class="test-section">
        <h2>1. JavaScript Syntax Validation</h2>
        <button onclick="testSyntax()">Test Script Syntax</button>
        <div id="syntax-results"></div>
    </div>

    <div class="test-section">
        <h2>2. DOM Element Validation</h2>
        <button onclick="testDOM()">Test DOM Elements</button>
        <div id="dom-results"></div>
    </div>

    <div class="test-section">
        <h2>3. Event Listener Test</h2>
        <button onclick="testEventListeners()">Test Event Listeners</button>
        <div id="event-results"></div>
    </div>

    <div class="test-section">
        <h2>4. API Test (Safe Mock)</h2>
        <button onclick="testAPI()">Test API Structure</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>5. File Content Analysis</h2>
        <button onclick="analyzeScriptFile()">Analyze script.js</button>
        <div id="file-results"></div>
    </div>

    <div class="test-section">
        <h2>6. Line-by-Line Parser</h2>
        <textarea id="code-input" placeholder="Paste JavaScript code here to check syntax..."></textarea>
        <button onclick="parseCode()">Parse Code</button>
        <div id="parse-results"></div>
    </div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            return `<div class="${type}">[${type.toUpperCase()}] ${message}</div>`;
        }

        function testSyntax() {
            const results = document.getElementById('syntax-results');
            results.innerHTML = '<div class="info">Testing JavaScript syntax...</div>';
            
            try {
                // Test basic JavaScript parsing
                const testCode = `
                    function test() {
                        const obj = { a: 1, b: 2 };
                        return obj;
                    }
                `;
                new Function(testCode);
                results.innerHTML += log('âœ“ Basic JavaScript syntax OK', 'pass');
                
                // Test async/await
                const asyncTest = `
                    async function testAsync() {
                        await Promise.resolve();
                        return true;
                    }
                `;
                new Function(asyncTest);
                results.innerHTML += log('âœ“ Async/await syntax OK', 'pass');
                
                // Test event listeners
                const eventTest = `
                    document.addEventListener('click', () => {
                        console.log('test');
                    });
                `;
                new Function(eventTest);
                results.innerHTML += log('âœ“ Event listener syntax OK', 'pass');
                
            } catch (error) {
                results.innerHTML += log(`âœ— Syntax Error: ${error.message}`, 'fail');
            }
        }

        function testDOM() {
            const results = document.getElementById('dom-results');
            results.innerHTML = '<div class="info">Testing DOM elements...</div>';
            
            const expectedElements = [
                'new-game-btn', 'load-game-btn', 'character-creation-screen',
                'char-name', 'char-class', 'char-background', 'create-character-btn',
                'game-play-screen', 'game-output', 'move-btn', 'interact-btn'
            ];
            
            let found = 0;
            expectedElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    results.innerHTML += log(`âœ“ Found element: ${id}`, 'pass');
                    found++;
                } else {
                    results.innerHTML += log(`âœ— Missing element: ${id}`, 'fail');
                }
            });
            
            results.innerHTML += log(`Found ${found}/${expectedElements.length} elements`, found === expectedElements.length ? 'pass' : 'warning');
        }

        function testEventListeners() {
            const results = document.getElementById('event-results');
            results.innerHTML = '<div class="info">Testing event listeners...</div>';
            
            try {
                // Test if we can add event listeners
                const testBtn = document.createElement('button');
                testBtn.addEventListener('click', () => {});
                results.innerHTML += log('âœ“ Event listener attachment works', 'pass');
                
                // Test DOMContentLoaded
                if (document.readyState === 'complete' || document.readyState === 'interactive') {
                    results.innerHTML += log('âœ“ DOM is ready', 'pass');
                } else {
                    results.innerHTML += log('âš  DOM not fully loaded', 'warning');
                }
                
            } catch (error) {
                results.innerHTML += log(`âœ— Event listener error: ${error.message}`, 'fail');
            }
        }

        function testAPI() {
            const results = document.getElementById('api-results');
            results.innerHTML = '<div class="info">Testing API structure...</div>';
            
            try {
                // Test fetch availability
                if (typeof fetch !== 'undefined') {
                    results.innerHTML += log('âœ“ Fetch API available', 'pass');
                } else {
                    results.innerHTML += log('âœ— Fetch API not available', 'fail');
                }
                
                // Test JSON methods
                const testObj = { test: 'value' };
                const jsonStr = JSON.stringify(testObj);
                const parsed = JSON.parse(jsonStr);
                results.innerHTML += log('âœ“ JSON methods work', 'pass');
                
                // Test Promise
                Promise.resolve().then(() => {
                    results.innerHTML += log('âœ“ Promises work', 'pass');
                });
                
            } catch (error) {
                results.innerHTML += log(`âœ— API test error: ${error.message}`, 'fail');
            }
        }

        async function analyzeScriptFile() {
            const results = document.getElementById('file-results');
            results.innerHTML = '<div class="info">Analyzing script.js file...</div>';
            
            try {
                const response = await fetch('./script.js');
                const content = await response.text();
                
                results.innerHTML += log(`âœ“ File loaded, ${content.length} characters`, 'pass');
                
                // Check for common issues
                const lines = content.split('\n');
                results.innerHTML += log(`File has ${lines.length} lines`, 'info');
                
                // Check brace balance
                let braceCount = 0;
                let parenCount = 0;
                let bracketCount = 0;
                
                for (let char of content) {
                    if (char === '{') braceCount++;
                    if (char === '}') braceCount--;
                    if (char === '(') parenCount++;
                    if (char === ')') parenCount--;
                    if (char === '[') bracketCount++;
                    if (char === ']') bracketCount--;
                }
                
                if (braceCount === 0) {
                    results.innerHTML += log('âœ“ Braces balanced', 'pass');
                } else {
                    results.innerHTML += log(`âœ— Brace imbalance: ${braceCount}`, 'fail');
                }
                
                if (parenCount === 0) {
                    results.innerHTML += log('âœ“ Parentheses balanced', 'pass');
                } else {
                    results.innerHTML += log(`âœ— Parentheses imbalance: ${parenCount}`, 'fail');
                }
                
                if (bracketCount === 0) {
                    results.innerHTML += log('âœ“ Brackets balanced', 'pass');
                } else {
                    results.innerHTML += log(`âœ— Bracket imbalance: ${bracketCount}`, 'fail');
                }
                
                // Check for unterminated strings
                const stringRegex = /(['"`])((?:(?!\1)[^\\]|\\.)*)(\1)?/g;
                let match;
                let unterminatedStrings = 0;
                while ((match = stringRegex.exec(content)) !== null) {
                    if (!match[3]) {
                        unterminatedStrings++;
                    }
                }
                
                if (unterminatedStrings === 0) {
                    results.innerHTML += log('âœ“ No unterminated strings', 'pass');
                } else {
                    results.innerHTML += log(`âœ— Found ${unterminatedStrings} unterminated strings`, 'fail');
                }
                
                // Show last 10 lines
                const lastLines = lines.slice(-10);
                results.innerHTML += log('Last 10 lines of file:', 'info');
                results.innerHTML += `<pre>${lastLines.map((line, i) => `${lines.length - 10 + i + 1}: ${line}`).join('\n')}</pre>`;
                
            } catch (error) {
                results.innerHTML += log(`âœ— File analysis error: ${error.message}`, 'fail');
            }
        }

        function parseCode() {
            const results = document.getElementById('parse-results');
            const code = document.getElementById('code-input').value;
            results.innerHTML = '<div class="info">Parsing code...</div>';
            
            if (!code.trim()) {
                results.innerHTML += log('Please enter code to parse', 'warning');
                return;
            }
            
            try {
                new Function(code);
                results.innerHTML += log('âœ“ Code syntax is valid', 'pass');
            } catch (error) {
                results.innerHTML += log(`âœ— Syntax Error: ${error.message}`, 'fail');
                
                // Try to identify the problematic line
                const lines = code.split('\n');
                results.innerHTML += log(`Code has ${lines.length} lines`, 'info');
                
                // Check each line individually
                for (let i = 0; i < lines.length; i++) {
                    try {
                        if (lines[i].trim()) {
                            new Function(lines[i]);
                        }
                    } catch (lineError) {
                        results.innerHTML += log(`Line ${i + 1} error: ${lineError.message}`, 'fail');
                        results.innerHTML += log(`Problematic line: ${lines[i]}`, 'info');
                    }
                }
            }
        }

        // Auto-run basic tests on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Debug suite loaded');
            setTimeout(() => {
                testSyntax();
                testEventListeners();
            }, 500);
        });
    </script>
</body>
</html>
